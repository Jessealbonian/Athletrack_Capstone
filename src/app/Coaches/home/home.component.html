<div class="flex h-screen flex-col" style="background-color: white;">
  <app-sidenav (navToggled)="onNavToggled($event)" class="fixed top-0 left-0 h-full z-10"></app-sidenav>
  <app-navbar class="relative z-20"></app-navbar>
  <div class="content-area">
    <div class="dashboard-container">
      <div class="transition-all duration-300 z-1 mt-16" [class.lg:ml-64]="isNavOpen" [class.lg:ml-20]="!isNavOpen">
        <!-- Main Content -->
        <div class="p-4">
          <div class="mb-4 p-2 flex justify-between items-center">
            <h1 class="text-2xl">Dashboard</h1>
            <!-- <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Export</button> -->
          </div>

          <div class="flex justify-end ">
            <button (click)="generateReport()" 
                class="bg-green-900 text-white px-4 py-2 rounded hover:bg-green-1000 transition duration-200 mr-2 mb-4">
                <i class="fas fa-download"></i> Generate Report
            </button> <!--(click)="generateReport()" -->
        </div>

          <!-- Statistics Cards -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
            <!-- Total Students -->
            <div class="bg-white rounded-lg shadow-lg transform transition-transform duration-300 p-6 border-l-4" style="border-left-color: #15957F;">
              <div class="flex items-center mb-4">
                <div class="p-3 rounded-full mr-3" style="background-color: rgba(21, 149, 127, 0.1);">
                  <i class="fas fa-users" style="color: #15957F; font-size: 1.5rem;"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-800">Total Students</h3>
              </div>
              <p class="text-3xl font-bold" style="color: #15957F;">{{ totalStudents }}</p>
              <p class="text-sm text-gray-500 mt-1">Enrolled across all classes</p>
            </div>

            <!-- Total Classes -->
            <div class="bg-white rounded-lg shadow-lg transform transition-transform duration-300 p-6 border-l-4" style="border-left-color: #0A7664;">
              <div class="flex items-center mb-4">
                <div class="p-3 rounded-full mr-3" style="background-color: rgba(10, 118, 100, 0.1);">
                  <i class="fas fa-chalkboard-teacher" style="color: #0A7664; font-size: 1.5rem;"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-800">Total Classes</h3>
              </div>
              <p class="text-3xl font-bold" style="color: #0A7664;">{{ totalClasses }}</p>
              <p class="text-sm text-gray-500 mt-1">Active classes</p>
            </div>

            <!-- Upcoming Events -->
            <div class="bg-white rounded-lg shadow-lg transform transition-transform duration-300 p-6 border-l-4" style="border-left-color: #22473F;">
              <div class="flex items-center mb-4">
                <div class="p-3 rounded-full mr-3" style="background-color: rgba(34, 71, 63, 0.1);">
                  <i class="fas fa-calendar-alt" style="color: #22473F; font-size: 1.5rem;"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-800">Upcoming Events</h3>
              </div>
              <p class="text-3xl font-bold" style="color: #22473F;">{{ (filteredEvents && filteredEvents.length) || 0 }}</p>
              <button (click)="showUpcomingEventsModal = true" class="mt-2 text-sm" style="color: #22473F;">View All Events â†’</button>
            </div>
          </div>

          <!-- Line Graph Section -->
          <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Student Activity Over Time</h2>
            <div class="h-64 sm:h-80 lg:h-96">
              <canvas id="lineChart"></canvas>
            </div>
          </div>

          <!-- Pie Charts Section -->
          <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Routine Completion by Class (This Week)</h2>
            <div *ngIf="!classCompletionStats || classCompletionStats.length === 0" class="text-center py-8 text-gray-500">
              <i class="fas fa-chart-pie text-4xl mb-2"></i>
              <p>No class completion data available</p>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" *ngIf="classCompletionStats && classCompletionStats.length > 0">
              <div *ngFor="let stat of classCompletionStats" class="bg-gray-50 rounded-lg p-4">
                <div class="h-64">
                  <canvas [id]="'pieChart-' + stat.class_id"></canvas>
                </div>
                <div class="mt-4 text-center">
                  <p class="font-semibold text-gray-800">{{ stat.class_name || 'Class ' + stat.class_id }}</p>
                  <p class="text-sm text-gray-600 mt-1">
                    Completed: <span style="color: #15957F;">{{ stat.completed }}</span> / 
                    Total: {{ stat.total_enrolled }}
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Upcoming Events Modal -->
          <!-- <div *ngIf="showUpcomingEventsModal" class="fixed inset-0 z-50 overflow-y-auto">
            <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
              <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
              <span class="hidden sm:inline-block sm:align-middle sm:h-screen">&#8203;</span>
              <div
                class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6">
                  <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Upcoming Events</h3>
                    <span class="px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-600">
                      {{ upcomingEvents.length }} Events
                    </span>
                  </div>
                  <div class="space-y-4">
                    <div *ngFor="let event of upcomingEvents" class="border-b pb-4">
                      <div class="flex justify-between items-start">
                        <div>
                          <h4 class="font-medium">{{ event.title }}</h4>
                          <p class="text-sm text-gray-600">{{ event.date | date }} at {{ event.time }}</p>
                          <p class="text-sm text-gray-600">{{ event.location }}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-600">
                          {{ event.attendees }} Attendees
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                  <button type="button" (click)="showUpcomingEventsModal = false"
                    class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:w-auto sm:text-sm">
                    Close
                  </button>
                </div>
              </div>
            </div>
          </div> -->

          <div *ngIf="showUpcomingEventsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <!-- Modal Header -->
                <div class="border-b px-6 py-4 flex justify-between items-center">
                    <h2 class="text-xl font-semibold">Upcoming Events</h2>
                    <button (click)="showUpcomingEventsModal = false" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Modal Content -->
                <div class="p-6">
                    <div class="grid gap-4">
                        <div *ngFor="let event of filteredEvents" 
                             class="bg-white rounded-lg border p-4 hover:shadow-md transition-shadow">
                            <div class="flex items-center gap-4">
                                <img [src]="event.image" 
                                     [alt]="event.title"
                                     class="w-16 h-16 object-cover rounded">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-lg">{{event.title}}</h3>
                                    <div class="flex items-center gap-2 text-gray-600">
                                        <i class="fa-regular fa-calendar"></i>
                                        <span>{{event.date | date:'mediumDate'}}</span>
                                    </div>
                                    <div class="flex items-center gap-2 text-gray-600">
                                        <i class="fa-regular fa-clock"></i>
                                        <span>
                                            {{event.date + ' ' + event.time | date:'shortTime'}} - 
                                            {{event.date + ' ' + event.end_time | date:'shortTime'}}
                                            ({{event.duration}})
                                        </span>
                                    </div>
                                </div>
                                <div class="px-3 py-1 rounded-full text-sm" style="background-color: rgba(21, 149, 127, 0.1); color: #15957F;">
                                    {{event.status}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="border-t px-6 py-4 flex justify-end">
                    <button (click)="showUpcomingEventsModal = false" 
                            class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded">
                        Close
                    </button>
                </div>
            </div>
        </div>
