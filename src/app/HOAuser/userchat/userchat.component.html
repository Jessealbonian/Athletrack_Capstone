<div class="flex h-screen flex-col">
  <app-sidenav
    (navToggled)="onNavToggled($event)"
    class="fixed top-0 left-0 h-full z-10"
  ></app-sidenav>
  <app-navbar class="relative z-20"></app-navbar>
  <div class="content-area">
    <div class="dashboard-container">
      <div
        class="transition-all duration-300 z-1 mt-16"
        [class.lg:ml-64]="isNavOpen"
        [class.lg:ml-20]="!isNavOpen"
      >
        <div class="dashboard-container">
          <!-- Main Content -->
          <!-- Chat Container -->
          <div class="sm:ml-3 ml-12 mt-8">
            <div
              class="rounded-lg bg-white shadow-lg flex flex-col lg:flex-row gap-6 h-screen lg:h-[870px] md:h-[750px]"
            >
              <!-- Sidebar for Contact List -->
              <div
                class="lg:w-1/4 bg-white shadow-lg rounded-lg p-4 overflow-y-auto"
                [class.hidden]="!showContacts && !isLargeScreen"
              >
                <h2 class="text-lg font-semibold mb-4">Contacts</h2>
                <!-- Admin Contacts -->
                <ul>
                  <h3 class="text-lg font-semibold">Admins</h3>
                  <li
                    *ngFor="let contact of contacts"
                    [hidden]="contact.type !== 'admin'"
                    class="mb-3"
                  >
                    <button
                      class="w-full text-left p-2 rounded-lg hover:bg-gray-200 flex items-center gap-3 relative"
                      (click)="selectContact(contact)"
                    >
                      <div
                        class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-semibold"
                      >
                        {{ getInitials(contact.username) }}
                      </div>
                      <span class="font-medium">{{ contact.username }}</span>
                      
                      <!-- Notification Dot -->
                      <span *ngIf="hasUnreadMessage(contact.id)" class="absolute right-2">
                        <span class="relative flex h-3 w-3">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-sky-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-3 w-3 bg-sky-500"></span>
                        </span>
                      </span>
                    </button>
                  </li>
                </ul>

                <!-- User Contacts -->
                <ul>
                  <h3 class="text-lg font-semibold">Users</h3>
                  <li
                    *ngFor="let contact of contacts"
                    [hidden]="contact.type !== 'user'"
                    class="mb-3"
                  >
                    <button
                      class="w-full text-left p-2 rounded-lg hover:bg-gray-200 flex items-center gap-3 relative"
                      (click)="selectContact(contact)"
                    >
                      <div
                        class="w-10 h-10 rounded-full bg-green-500 text-white flex items-center justify-center font-semibold"
                      >
                        {{ getInitials(contact.username) }}
                      </div>
                      <span class="font-medium">{{ contact.username }}</span>
                      
                      <!-- Notification Dot -->
                      <span *ngIf="hasUnreadMessage(contact.id)" class="absolute right-2">
                        <span class="relative flex h-3 w-3">
                          <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-sky-400 opacity-75"></span>
                          <span class="relative inline-flex rounded-full h-3 w-3 bg-sky-500"></span>
                        </span>
                      </span>
                    </button>
                  </li>
                </ul>
              </div>

              <!-- Chatbox -->
              <div
                class="lg:w-3/4 bg-white shadow-lg rounded-lg flex flex-col h-full"
              >
                <!-- Chat Header -->
                <div class="p-4 border-b flex items-center justify-between">
                  <div
                    *ngIf="selectedContact; else defaultHeader"
                    class="flex items-center"
                  >
                    <div
                      class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-semibold mr-3"
                    >
                      {{ getInitials(selectedContact.username) }}
                    </div>
                    <div>
                      <h3 class="text-lg font-semibold">
                        {{ selectedContact.username }}
                      </h3>
                      <span class="text-sm text-gray-500">Online</span>
                    </div>
                  </div>

                  <!-- Default Header Message when no contact is selected -->
                  <ng-template #defaultHeader>
                    <div class="text-sm text-gray-500">
                      Select a contact to start chatting
                    </div>
                  </ng-template>

                  <!-- Toggle Button for Contact List -->
                  <button
                    class="lg:hidden p-2 rounded-lg bg-gray-200 hover:bg-gray-300"
                    (click)="toggleContacts()"
                  >
                    ðŸ“œ Contacts
                  </button>
                </div>

                <div
                  #messagesContainer
                  class="flex-1 p-4 overflow-y-auto bg-white rounded-b-lg"
                >
                  <div
                    *ngIf="!selectedContact"
                    class="flex justify-center items-center h-full text-gray-500"
                  >
                    Click on a contact to start chatting!
                  </div>

                  <div
                    *ngFor="let message of messages"
                    class="mb-4 flex items-end"
                    [ngClass]="{ 'justify-end': message.isCurrentUser }"
                  >
                    <!-- Avatar -->
                    <div
                      *ngIf="!message.isCurrentUser"
                      class="w-10 h-10 rounded-full bg-blue-500 text-white flex items-center justify-center font-semibold mr-3"
                    >
                      {{
                        message.senderName
                          ? getInitials(message.senderName)
                          : "U"
                      }}
                    </div>

                    <!-- Message Container -->
                    <div>
                      <div
                        class="p-3 rounded-lg max-w-md"
                        [ngClass]="{
                          'bg-blue-500 text-white': message.isCurrentUser,
                          'bg-gray-200 text-gray-800': !message.isCurrentUser
                        }"
                      >
                        <div class="text-sm">{{ message.content }}</div>
                      </div>
                      <!-- Timestamp -->
                      <div
                        class="text-xs text-gray-500 mt-1"
                        [ngClass]="{ 'text-right': message.isCurrentUser }"
                      >
                        {{ message.timestamp }}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Message Input -->
                <div
                  *ngIf="selectedContact"
                  class="p-4 border-t flex items-center gap-3 bg-white"
                >
                  <input
                    [(ngModel)]="newMessage"
                    type="text"
                    placeholder="Type a message..."
                    (keydown.enter)="sendMessage()"
                    class="flex-1 bg-gray-100 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                  <button
                    (click)="sendMessage()"
                    class="p-3 rounded-lg hover:bg-blue-100"
                  >
                    <i
                      class="fa-solid fa-paper-plane"
                      style="color: #1468f0"
                    ></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
